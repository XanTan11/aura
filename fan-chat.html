<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Fan Chat</title>
    <link rel="stylesheet" href="./style.css">

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AURA FC ‚Äî Fan Chat</title>

  <!-- ‚úÖ –í–ê–ñ–ù–û: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π -->
  <link rel="stylesheet" href="css/fansite.css" />
</head>

<body>
  <!-- Background FX (–∫–∞–∫ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–∞–π—Ç–µ) -->
  <div class="bg-glow"></div>
  <div class="bg-grid"></div>

  <header class="header glass">
    <div class="brand">
      <span class="brand__ring" aria-hidden="true"></span>

      <div class="brand__logoWrap" aria-hidden="true">
        <span class="brand__spin"></span>
        <img
          class="brand__logo"
          src="https://i.postimg.cc/Jh3VMVc6/Snimok-ekrana-2025-12-16-233959-removebg-preview.png"
          alt="AURA FC"
        />
      </div>

      <div class="brand__text">
        <div class="brand__name">AURA FC ‚Äî Fan Chat</div>
        <div class="brand__tag" id="status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ‚Ä¶</div>
        
      </div>
    </div>

    <a class="btn btn--ghost" href="index.html">‚Üê –ù–∞–∑–∞–¥</a>
  </header>

  <main class="main container">
    <section class="panel glass">
      <div class="topbar">
        <div class="hint">–û–±—â–∏–π —á–∞—Ç: –≤—Å–µ –≤–∏–¥—è—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ä–∞–∑—É ‚úÖ</div>
        <div class="hint" id="count"></div>
      </div>

      <div class="messages" id="messages"></div>

      <form id="form" class="composer">
        <div class="row">
          <input class="input" id="nick" maxlength="18" placeholder="–ù–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä AuraFan)" />
          <input class="input" id="text" maxlength="200" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." />
        </div>
        <button class="btn send" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>

      <div class="small">–ü—Ä–∞–≤–∏–ª–∞: –±–µ–∑ —Å–ø–∞–º–∞ –∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π ü§ù</div>
    </section>
  </main>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBbgCTVN5VovfaU_svpTM-Y0T7JBa3RpVs",
      authDomain: "aura-73414.firebaseapp.com",
      projectId: "aura-73414",
      storageBucket: "aura-73414.firebasestorage.app",
      messagingSenderId: "768724167502",
      appId: "1:768724167502:web:cb2d7c03530a934f010c1f",
      measurementId: "G-CEVT28QXRE"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const statusEl = document.getElementById("status");
    const countEl = document.getElementById("count");
    const messagesEl = document.getElementById("messages");
    const form = document.getElementById("form");
    const nickEl = document.getElementById("nick");
    const textEl = document.getElementById("text");

    nickEl.value = localStorage.getItem("AURA_NICK") || "";

    function fmtTime(ts){
      const d = ts?.toDate ? ts.toDate() : new Date();
      return d.toLocaleTimeString([], { hour:"2-digit", minute:"2-digit" });
    }
    function initials(n){
      n = (n || "F").trim();
      return (n[0] || "F").toUpperCase();
    }

    function addMsg(m){
      const row = document.createElement("div");
      row.className = "msg";

      const av = document.createElement("div");
      av.className = "avatar";
      av.textContent = initials(m.nick);

      const bubble = document.createElement("div");
      bubble.className = "bubble";

      const meta = document.createElement("div");
      meta.className = "meta";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = m.nick;

      const time = document.createElement("div");
      time.className = "time";
      time.textContent = fmtTime(m.createdAt);

      const text = document.createElement("div");
      text.className = "text";
      text.textContent = m.text;

      meta.appendChild(name);
      meta.appendChild(time);
      bubble.appendChild(meta);
      bubble.appendChild(text);

      row.appendChild(av);
      row.appendChild(bubble);

      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function start() {
      try {
        await auth.signInAnonymously();
        statusEl.textContent = "–û–Ω–ª–∞–π–Ω ‚úÖ";
      } catch (e) {
        statusEl.textContent = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞";
        console.error(e);
        return;
      }

      db.collection("messages")
        .orderBy("createdAt", "asc")
        .limitToLast(150)
        .onSnapshot((snap) => {
          messagesEl.innerHTML = "";
          let total = 0;
          snap.forEach((doc) => {
            total++;
            addMsg(doc.data());
          });
          countEl.textContent = `–°–æ–æ–±—â–µ–Ω–∏–π: ${total}`;
        }, (err) => {
          statusEl.textContent = "–û—à–∏–±–∫–∞ Firestore";
          console.error(err);
        });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nick = (nickEl.value || "").trim() || "Fan";
      const text = (textEl.value || "").trim();
      if (!text) return;

      localStorage.setItem("AURA_NICK", nick);
      textEl.value = "";

      try {
        await db.collection("messages").add({
          nick,
          text,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      } catch (e) {
        console.error(e);
        statusEl.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å";
      }
    });

    start();
  </script>
</body>
</html>
    
  </body>
  
</html>
